---
title: CDN加速
date: 2019-10-15 14:31:43
tags: 网络
categories: 网络
---

>  CDN的全称是(Content Delivery Network)，即内容分发网络。其目的是通过在现有的Internet中增加一层新的CACHE(缓存)层，将网站的内容发布到最接近用户的网络”边缘“的节点，使用户可以就近取得所需的内容，提高用户访问网站的响应速度。从技术上全面解决由于网络带宽小、用户访问量大、网点分布不均等原因，提高用户访问网站的响应速度。
>
>  简单的说，CDN的工作原理就是将您源站的资源缓存到位于全球各地的CDN节点上，用户请求资源时，就近返回节点上缓存的资源，而不需要每个用户的请求都回您的源站获取，避免网络拥塞、缓解源站压力，保证用户访问资源的速度和体验。

![](< https://yxyuxuan.github.io/Markdown-repository/images/show-cdn-img.png >)



###  传统的网站访问过程 

- 用户在浏览器中输入要访问的域名;
- 浏览器向域名解析服务器发出解析请求，获得此域名对应的IP 地址;
- 浏览器利用所得到的IP 地址，向该IP对应的服务器发出访问请求;
- 服务器对此响应，将数据回传至用户浏览器端显示出来。

![](< https://yxyuxuan.github.io/Markdown-repository/images/normal-transform.png >)

###  使用CDN 缓存后的网站访问过程 

1. 用户在浏览器中输入要访问的域名;

2. 浏览器向域名解析服务器发出解析请求，由于CDN 对域名解析过程进行了调整，所以用户端一般得到的是该域名对应的 CNAME 记录，此时浏览器需要再次对获得的 CNAME 域名进行解析才能得到缓存服务器实际的IP 地址。 注：在此过程中，全局负载均衡DNS 解析服务器会根据用户端的源IP 地址，如地理位置(北京还是上海)、接入网类型(电信还是网通)将用户的访问请求定位到离用户路由最短、位置最近、负载最轻的Cache 节点(缓存服务器)上，实现就近定位。定位优先原则可按位置、可按路由、也可按负载等。

3. 再次解析后浏览器得到该域名CDN 缓存服务器的实际IP 地址，向缓存服务器发出访问请求;

4. 缓存服务器根据浏览器提供的域名，通过Cache 内部专用DNS 解析得到此域名源服务器的真实IP 地址，再由缓存服务器向此真实IP 地址提交访问请求;

5. 缓存服务器从真实IP 地址得到内容后，一方面在本地进行保存，以备以后使用，同时把得到的数据发送到客户端浏览器，完成访问的响应过程;

6. 用户端得到由缓存服务器传回的数据后显示出来，至此完成整个域名访问过程。

   

![](< https://yxyuxuan.github.io/Markdown-repository/images/cdn-detail.png >)



### CNAME记录（CNAME record）

CNAME即别名( Canonical Name )；可以用来把一个域名解析到另一个域名，当 DNS 系统在查询 CNAME 左面的名称的时候，都会转向 CNAME 右面的名称再进行查询，一直追踪到最后的 PTR 或 A 名称，成功查询后才会做出回应，否则失败。
例如，你有一台服务器上存放了很多资料，你使用`docs.example.com`去访问这些资源，但又希望通过`documents.example.com`也能访问到这些资源，那么你就可以在您的DNS解析服务商添加一条CNAME记录，将`documents.example.com`指向`docs.example.com`，添加该条CNAME记录后，所有访问`documents.example.com`的请求都会被转到`docs.example.com`，获得相同的内容。

### CNAME域名

接入CDN时，在CDN提供商控制台添加完加速域名后，您会得到一个CDN给您分配的CNAME域名， 您需要在您的DNS解析服务商添加CNAME记录，将自己的加速域名指向这个CNAME域名，这样该域名所有的请求才会都将转向CDN的节点，达到加速效果。

### DNS

DNS即Domain Name System，是域名解析服务的意思。它在互联网的作用是：把域名转换成为网络可以识别的ip地址。人们习惯记忆域名，但机器间互相只认IP地址，域名与IP地址之间是一一对应的，它们之间的转换工作称为域名解析，域名解析需要由专门的域名解析服务器来完成，整个过程是自动进行的。比如：上网时输入的`www.baidu.com`会自动转换成为`220.181.112.143`。
常见的DNS解析服务商有：阿里云解析，万网解析，DNSPod，新网解析，Route53（AWS），Dyn，Cloudflare等。

